<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Tempo Moderato - Fix Final</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: #1e293b; padding: 30px; border-radius: 20px; text-align: center; width: 350px; border: 1px solid #334155; }
        .btn { background: #38bdf8; color: black; border: none; padding: 12px; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        #status { margin-top: 20px; font-size: 14px; color: #94a3b8; }
    </style>
</head>
<body>
    <div class="card">
        <h2>TEMPO NETWORK</h2>
        <div id="connectSect">
            <button class="btn" onclick="conectar()">Ligar Carteira</button>
        </div>
        <div id="mintSect" style="display:none;">
            <button class="btn" style="background:#22c55e; color:white;" onclick="executarMint()">Confirmar Saldo e Mint</button>
        </div>
        <div id="status">Aguardando...</div>
    </div>

<script>
    let provedor, signatario, conta;

    async function conectar() {
        const carteira = window.rabby || window.ethereum;
        if (!carteira) return alert("Instale a Rabby Wallet");
        
        const contas = await carteira.request({ method: 'eth_requestAccounts' });
        conta = contas[0];
        provedor = new ethers.providers.Web3Provider(carteira);
        signatario = provedor.getSigner();

        document.getElementById('connectSect').style.display = 'none';
        document.getElementById('mintSect').style.display = 'block';
        document.getElementById('status').innerText = "Ligado: " + conta.slice(0,6) + "...";
    }

    async function executarMint() {
        const log = document.getElementById('status');
        log.innerText = "A validar saldo TIP-20...";

        try {
            // Endereço inserido diretamente sem variáveis para evitar erro de aspas
            const contrato = new ethers.Contract(
                "0x515f5f64904E22713f15b56fdE37Cf6d23DBF7037", 
                ["function mint(address to, uint256 amount) public"], 
                signatario
            );

            // Se você tem saldo, esta chamada vai abrir a sua carteira agora
            const tx = await contrato.mint(conta, ethers.utils.parseUnits("1", 18), {
                gasLimit: 1000000 
            });

            log.innerText = "Transação enviada! Verifique a carteira.";
            await tx.wait();
            log.innerHTML = "<b style='color:#22c55e'>SUCESSO NO MINT!</b>";
        } catch (err) {
            console.error(err);
            // Este erro aparece se o saldo não for do tipo TIP-20 (USD/USDC)
            log.innerHTML = "<b style='color:#f87171'>Erro: O saldo deve ser em USDC/USD na rede Moderato.</b>";
        }
    }
</script>
</body>
</html>
