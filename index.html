<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Tempo Hub - VIP Mint</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --primary: #38bdf8; --bg: #0f172a; --card: #1e293b; --success: #22c55e; }
        body { background: var(--bg); color: white; font-family: sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .container { background: var(--card); padding: 2rem; border-radius: 20px; text-align: center; width: 350px; border: 1px solid #334155; }
        .btn { background: var(--primary); color: #000; border: none; padding: 1rem; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 10px; }
        #status { font-size: 0.8rem; color: #94a3b8; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>TEMPO HUB</h2>
        <p style="font-size: 0.7rem; color: var(--primary);">MODERATO TIP-20 MINT</p>
        <button id="mintBtn" class="btn">MINT STARTER KIT</button>
        <div id="status">Pronto para interagir.</div>
    </div>

<script>
    // Limpeza absoluta do endereço
    const CONTRACT_RAW = "0x515f5f64904E22713f15b56fdE37Cf6d23DBF7037";
    const CONTRACT_ADDR = CONTRACT_RAW.replace(/[^a-fA-F0-9x]/g, "").trim();
    const CHAIN_ID = "0xa5bf"; 

    const ABI = ["function mint(address to, uint256 amount) public"];

    async function start() {
        const providerOrigin = window.rabby || window.ethereum;
        if (!providerOrigin) return alert("Instala a Rabby Wallet!");

        const btn = document.getElementById('mintBtn');
        const status = document.getElementById('status');

        btn.onclick = async () => {
            try {
                btn.disabled = true;
                // Resolve "unknown account #0"
                const accounts = await providerOrigin.request({ method: 'eth_requestAccounts' });
                const provider = new ethers.providers.Web3Provider(providerOrigin, "any");
                const signer = provider.getSigner();

                status.innerText = "Configurando Taxas TIP-20...";

                // Lógica de transação sugerida pela documentação Tempo
                const txParams = {
                    gasLimit: 1000000, // Limite alto para evitar falha na estimativa
                    gasPrice: await provider.getGasPrice(), // Obtém o preço atual da rede
                };

                const contract = new ethers.Contract(CONTRACT_ADDR, ABI, signer);
                
                status.innerText = "Aguardando assinatura na Rabby...";
                const tx = await contract.mint(accounts[0], ethers.utils.parseUnits("1", 18), txParams);

                status.innerHTML = `Enviada! <br><small>${tx.hash.substring(0,15)}...</small>`;
                await tx.wait();
                status.innerHTML = "<b style='color:#22c55e'>MINT COM SUCESSO!</b>";
            } catch (err) {
                console.error(err);
                status.innerText = "Erro: " + err.message.substring(0, 40);
            } finally {
                btn.disabled = false;
            }
        };
    }
    start();
</script>
</body>
</html>
