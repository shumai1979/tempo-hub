<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <title>Tempo Fix - Final</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: #1e293b; padding: 30px; border-radius: 20px; text-align: center; width: 380px; border: 1px solid #334155; }
        .btn { background: #22c55e; color: white; border: none; padding: 15px; width: 100%; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 20px; }
        #status { margin-top: 20px; font-size: 13px; color: #94a3b8; }
    </style>
</head>
<body>
    <div class="card">
        <h3>TEMPO TESTNET</h3>
        <p style="font-size: 11px; color: #64748b;">Moderato L1 Integration</p>
        <button class="btn" id="btnAcao" onclick="iniciar()">Ligar e Executar</button>
        <div id="status">Aguardando interação...</div>
    </div>

<script>
    async function iniciar() {
        const log = document.getElementById('status');
        const carteira = window.rabby || window.ethereum;
        
        try {
            const contas = await carteira.request({ method: 'eth_requestAccounts' });
            const provedor = new ethers.providers.Web3Provider(carteira);
            const signatario = provedor.getSigner();

            // FIX: Endereço todo em minúsculas para evitar erro de Checksum
            const contratoAddr = "0x515f5f64904e22713f15b56fde37cf6d23dbf7037";
            const contrato = new ethers.Contract(contratoAddr, ["function mint(address to, uint256 amount) public"], signatario);

            log.innerText = "A processar com saldo USD...";

            // Forçamos o envio ignorando a estimativa da Rabby que está confusa
            const tx = await contrato.mint(contas[0], ethers.utils.parseUnits("1", 18), {
                gasLimit: 1000000 
            });

            log.innerText = "Transação enviada! Aguarde...";
            await tx.wait();
            log.innerHTML = "<b style='color:#22c55e'>SUCESSO!</b>";
        } catch (err) {
            console.error(err);
            log.innerHTML = "<span style='color:#f87171'>Erro: Verifique se o USD está selecionado para gás na Rabby.</span>";
        }
    }
</script>
</body>
</html>
