<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tempo Hub - Final Review Build</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        body { background: #0f172a; color: white; font-family: sans-serif; text-align: center; padding-top: 50px; }
        .card { background: #1e293b; padding: 30px; border-radius: 20px; display: inline-block; border: 1px solid #38bdf8; }
        button { background: #38bdf8; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        #status { margin-top: 20px; color: #94a3b8; font-size: 0.9rem; }
    </style>
</head>
<body>
    <div class="card">
        <h1>Moderato Mint v4.0</h1>
        <div id="walletSection">A carregar...</div>
        <div id="mintSection" style="display:none">
            <button id="mintBtn">EXECUTAR MINT</button>
        </div>
        <p id="status">Verifica se tens AlphaUSD na carteira.</p>
    </div>

    <script>
        const ADDR = "0x20c0000000000000000000000000000000000005";
        const ABI = ["function mint(address to, uint256 amount) public"];
        let signer;

        window.addEventListener("eip6963:announceProvider", (e) => {
            if (e.detail.info.name !== "Rabby Wallet") return;
            const btn = document.createElement("button");
            btn.innerText = "Ligar Rabby";
            btn.onclick = async () => {
                const p = new ethers.providers.Web3Provider(e.detail.provider);
                await p.send("eth_requestAccounts", []);
                signer = p.getSigner();
                document.getElementById('walletSection').style.display = 'none';
                document.getElementById('mintSection').style.display = 'block';
                document.getElementById('status').innerText = "Ligado à Moderato.";
            };
            document.getElementById('walletSection').innerHTML = "";
            document.getElementById('walletSection').appendChild(btn);
        });
        window.dispatchEvent(new Event("eip6963:requestProvider"));

        document.getElementById('mintBtn').onclick = async () => {
            const status = document.getElementById('status');
            try {
                status.innerText = "A enviar... (Ignora erro de simulação)";
                const contract = new ethers.Contract(ADDR, ABI, signer);
                const val = ethers.utils.parseUnits("9982000", 18);
                
                const tx = await contract.mint(await signer.getAddress(), val, {
                    gasLimit: 500000,
                    gasPrice: 1000000002
                });
                status.innerText = "Transação enviada! Aguarda...";
                await tx.wait();
                status.innerHTML = "<b style='color:green'>SUCESSO!</b>";
            } catch (err) {
                console.error(err);
                status.innerText = "Erro: " + (err.reason || "Verifica saldo de AlphaUSD.");
            }
        };
    </script>
</body>
</html>
