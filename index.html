<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tempo Hub - Final Fix</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --primary: #38bdf8; --bg: #0f172a; --card: #1e293b; }
        body { background: var(--bg); color: white; font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .container { background: var(--card); padding: 2rem; border-radius: 20px; text-align: center; width: 400px; border: 1px solid #334155; }
        .btn { background: var(--primary); color: #0f172a; border: none; padding: 1rem; width: 100%; border-radius: 10px; font-weight: bold; cursor: pointer; margin-top: 10px; }
        #status { margin-top: 1rem; font-size: 0.9rem; color: #94a3b8; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Tempo Hub</h2>
        <div id="walletMenu">A procurar Rabby...</div>
        <div id="controls" style="display:none">
            <button id="mintBtn" class="btn">MINT STARTER KIT</button>
            <p id="status">Pronto para testar.</p>
        </div>
    </div>

<script>
    const CONTRACT = "0x515f564904E22713f15b56fdE37cF6d23dBF7037";
    const ABI = ["function mintStarterKit() public payable"];
    let signer;

    // Resolve conflitos de múltiplas carteiras (image_e14934)
    window.addEventListener("eip6963:announceProvider", (e) => {
        if (e.detail.info.name === "Rabby Wallet") {
            const btn = document.createElement("button");
            btn.className = "btn";
            btn.innerText = "Conectar Rabby";
            btn.onclick = async () => {
                const p = new ethers.providers.Web3Provider(e.detail.provider);
                await p.send("eth_requestAccounts", []);
                signer = p.getSigner();
                document.getElementById('walletMenu').style.display = 'none';
                document.getElementById('controls').style.display = 'block';
            };
            document.getElementById('walletMenu').innerHTML = "";
            document.getElementById('walletMenu').appendChild(btn);
        }
    });
    window.dispatchEvent(new Event("eip6963:requestProvider"));

    document.getElementById('mintBtn').onclick = async () => {
        const status = document.getElementById('status');
        try {
            status.innerText = "A enviar transação...";
            // Definir gasLimit manual para evitar erros de simulação (image_e1ccb0)
            const tx = await new ethers.Contract(CONTRACT, ABI, signer).mintStarterKit({ gasLimit: 300000 });
            status.innerText = "Pendente na rede...";
            await tx.wait();
            status.innerHTML = "<b style='color:#22c55e'>SUCESSO!</b>";
        } catch (err) {
            console.error(err);
            // Identifica se o erro é falta de PathUSD ou regra do contrato (image_e22e4a)
            if (err.message.includes("insufficient funds") || err.message.includes("PathUSD")) {
                status.innerHTML = "<b style='color:#f87171'>Erro: Precisas de PathUSD para as taxas!</b>";
            } else {
                status.innerHTML = "<b style='color:#f87171'>O contrato rejeitou. Provavelmente já fizeste o mint.</b>";
            }
        }
    };
</script>
</body>
</html>
