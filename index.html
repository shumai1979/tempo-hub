<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tempo Moderato - Protocol Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <style>
        :root { --primary: #38bdf8; --bg: #0f172a; --card: #1e293b; --error: #f87171; }
        body { background: var(--bg); color: white; font-family: system-ui, sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .container { background: var(--card); padding: 2rem; border-radius: 20px; text-align: center; width: 380px; border: 1px solid #334155; }
        .wallet-box { display: flex; flex-direction: column; gap: 10px; margin: 20px 0; }
        .btn-wallet { background: #2d3748; border: 1px solid #4a5568; color: white; padding: 12px; border-radius: 10px; cursor: pointer; font-weight: 600; }
        .btn-wallet:hover { border-color: var(--primary); }
        .btn-main { background: var(--primary); color: #000; border: none; padding: 15px; width: 100%; border-radius: 10px; font-weight: 800; cursor: pointer; display: none; }
        #status { margin-top: 15px; font-size: 0.8rem; color: #94a3b8; line-height: 1.4; }
    </style>
</head>
<body>
    <div class="container">
        <h3 style="margin:0">TEMPO PROTOCOL</h3>
        <p style="font-size: 0.75rem; color: var(--primary)">MODERATO L1 - TESTNET SUITE</p>
        
        <div id="setupView">
            <div class="wallet-box">
                <button class="btn-wallet" onclick="init('rabby')">Use Rabby Wallet</button>
                <button class="btn-wallet" onclick="init('meta')">Use MetaMask / Other</button>
            </div>
        </div>

        <div id="activeView" style="display:none">
            <div id="addrDisplay" style="font-size:0.7rem; background:#0f172a; padding:10px; border-radius:8px; margin-bottom:15px; border:1px solid #334155"></div>
            <button id="mintBtn" class="btn-main" onclick="runTask()">EXECUTE TEST TRANSACTION</button>
        </div>

        <div id="status">Please select your preferred provider.</div>
    </div>

<script>
    let signer, userAddress, provider;

    async function init(type) {
        const wallet = (type === 'rabby') ? window.rabby : window.ethereum;
        const status = document.getElementById('status');

        if (!wallet) {
            status.innerHTML = `<span style="color:red">Error: ${type} not found.</span>`;
            return;
        }

        try {
            status.innerText = "Connecting...";
            const accounts = await wallet.request({ method: 'eth_requestAccounts' });
            userAddress = accounts[0];
            provider = new ethers.providers.Web3Provider(wallet, "any");
            signer = provider.getSigner();

            document.getElementById('setupView').style.display = 'none';
            document.getElementById('activeView').style.display = 'block';
            document.getElementById('mintBtn').style.display = 'block';
            document.getElementById('addrDisplay').innerText = "Account: " + userAddress;
            status.innerText = "Connected to Moderato L1.";
        } catch (e) {
            status.innerText = "Connection failed.";
        }
    }

    async function runTask() {
